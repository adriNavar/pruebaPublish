@using System;
@using GeoSit.Data.BusinessEntities.MesaEntradas
@using GeoSit.Data.BusinessEntities.Common
@model METramite


@{
    //ViewBag.Title = "Edición de Tramites";

    bool PuedeGrabar = ViewBag.operacion != "Consulta" || Model.IdEstado == (int)Enumerators.EnumEstadoTramite.Procesado || Model.IdEstado == (int)Enumerators.EnumEstadoTramite.Finalizado || Model.IdEstado == (int)Enumerators.EnumEstadoTramite.Archivado;

    ViewBag.FechaIngreso = "";
    ViewBag.FechaVenc = "";
    ViewBag.FechaLibro = "";
}

<link href="~/Content/dataTables.bootstrap.css" rel="stylesheet" />
<link href="~/Content/bootstrap-fileinput/css/fileinput.css" rel="stylesheet" />
<link href="~/Content/bootstrap-fileinput/css/fileinput.min.css" rel="stylesheet" />
<link href="~/Content/EdicionTramite.css" rel="stylesheet" />
<link href="~/Content/formValidation.min.css" rel="stylesheet" />
<link href="~/Scripts/jstree/dist/themes/default/style.min.css" rel="stylesheet" />
<link href="~/Content/select2.css" rel="stylesheet" />
<link href="~/Content/select2-bootstrap.min.css" rel="stylesheet" />

<div class="modal fade theme_new" id="modal-EdicionTramite" tabindex="-2" data-backdrop="false" role="dialog" aria-labelledby="modal-windowLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div id="scroll-content-edicionTramite" class="scroll-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="lblEdicionTramite">@ViewBag.Title</h3>
                    <span id="cerrar" aria-hidden="true" class="fa fa-close fa-2x white cursor-pointer pull-right" aria-label="Cerrar" title="Cerrar"></span>
                </div>
                <div class="modal-body edicionTramite-body">
                    <div id="mesaEntradas-content" class="body-content">
                        @Html.Hidden("hdnLibroDiarioAbierto", (string)ViewBag.libroDiarioAbierto)
                        <input type="hidden" id="hdnEsProfesional" value="@((bool)ViewBag.esProfesional?1:0)" />
                        <div class="panel-group remove-margin">
                            <div class="panel panel-default remove-shadow" style="margin: 15px 0;">
                                <div class="panel-body">
                                    <form class="form-horizontal">
                                        <div class="form-group">
                                            <div class="col-xs-6">
                                                <label class="col-xs-3 control-label text-muted">
                                                    Identificador:
                                                </label>
                                                <div class="col-xs-6">
                                                    @Html.HiddenFor(model => model.IdTramite)
                                                    @Html.TextBox("txtIdTramite", System.Math.Max(Model.IdTramite, 0), new { @class = "form-control text-primary", @readonly = "readonly" })
                                                </div>
                                            </div>
                                            <div class="col-xs-6">
                                                <label class="col-xs-2 control-label text-muted">
                                                    Tr&aacute;mite:
                                                </label>
                                                <div class="col-xs-6">
                                                    @Html.TextBoxFor(model => model.Numero, new { @class = "form-control text-primary", @readonly = "readonly", @maxlength = "20" })
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="panel panel-default edicionTramite-panel" id="pnlGrpEdicionTramite" style="border:none;">
                                <div class="panel-body" id="pnlEdicionTramite">
                                    <ul id="tabDatosTramite" class="nav nav-tabs">
                                        <li class="nav-item active" data-tab="datosGenerales">
                                            <a class="nav-link" href="#tabDatosGenerales" data-toggle="tab">Datos Generales</a>
                                        </li>
                                        <li class="nav-item disabled" data-tab="datosEspecificos">
                                            <a class="nav-link" href="#tabDatosEspecificos" data-toggle="tab" id="datosEspecif">Datos Específicos</a>
                                        </li>
                                        <li class="nav-item" data-tab="notasAdjuntos">
                                            <a class="nav-link" href="#tabNotasAdjuntos" data-toggle="tab">Notas y Adjuntos</a>
                                        </li>
                                        @if (!(bool)ViewBag.esProfesional)
                                        {
                                            <li class="nav-item" data-tab="desgloses">
                                                <a class="nav-link" href="#tabDesgloses" data-toggle="tab">Desgloses</a>
                                            </li>
                                            <li class="nav-item" data-tab="movimientos">
                                                <a class="nav-link" href="#tabMovimientos" data-toggle="tab">Movimientos</a>
                                            </li>
                                            <li class="nav-item" data-tab="requisitos">
                                                <a class="nav-link" href="#tabRequisitos" data-toggle="tab">Requisitos</a>
                                            </li>
                                        }
                                    </ul>
                                    <div id="divTabContent" class="tab-content">
                                        <div id="tabDatosGenerales" class="tab-pane active">
                                            <div class="tab-body">
                                                <form id="divDatosGenerales" class="form-horizontal">
                                                    <div id="divTramite" class="form-group tabDatos">
                                                        @Html.Hidden("hdnOperacion", (string)ViewBag.operacion)
                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <label class="col-xs-4 control-label text-muted text-right">
                                                                        Fecha Ingreso:
                                                                    </label>
                                                                    <div class="col-xs-8 textBoxContainer">
                                                                        @if (Model.FechaIngreso.GetValueOrDefault().Year < 1900)
                                                                        {
                                                                            ViewBag.FechaIngreso = null;
                                                                        }
                                                                        else
                                                                        {
                                                                            ViewBag.FechaIngreso = Model.FechaIngreso.GetValueOrDefault().ToShortDateString();
                                                                        }
                                                                        @Html.TextBoxFor(model => model.FechaIngreso, new { @class = "form-control", @maxlength = "10", Value = ViewBag.FechaIngreso, @readonly = "readonly" })
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <label class="col-xs-4 control-label text-muted text-right">
                                                                        Estado:
                                                                    </label>
                                                                    <div class="col-xs-8 selectContainer">
                                                                        @Html.Hidden("hdnIdEstado", Model.IdEstado)
                                                                        @Html.TextBox("txtEstado", (string)ViewBag.estado, new { @class = "form-control text-primary", disabled = "disable", @readonly = "true" })
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <label class="col-xs-4 control-label text-muted text-right">
                                                                        Tipo:
                                                                    </label>
                                                                    <div class="col-xs-8 selectContainer">
                                                                        @Html.DropDownListFor(model => model.IdTipoTramite, (IEnumerable<SelectListItem>)ViewData["tiposTramites"], new { @id = "cboTipoTramite", @name = "cboTipoTramite", @class = "form-control input-sm", onchange = "tipoTramiteChange(this)", onfocus = "setearValorPrevio(this)" })
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <label class="col-xs-4 control-label text-muted text-right">
                                                                        Objeto:
                                                                    </label>
                                                                    <div class="col-xs-7 selectContainer">
                                                                        <input type="hidden" id="hdnIdObjetoTramite" value="@(Model.IdObjetoTramite == 0 ? "" : Model.IdObjetoTramite.ToString())" />
                                                                        @Html.DropDownListFor(model => model.IdObjetoTramite, new SelectListItem[0], new { @id = "cboObjetoTramite", @name = "cboObjetoTramite", @class = "form-control input-sm", onchange = "objetoTramiteChange(this.value,true)", onselectedindexchanged = "objetoTramiteChange(this.value,true)" })
                                                                    </div>
                                                                    <span class="fa fa-2x fa-question-circle blue-tooltip boton-deshabilitado" data-toggle="tooltip" data-placement="left" id="plantillaObjeto"></span>
                                                                    <span class="fa fa-2x fa-spin fa-spinner fa-fw" id="plantillaLoading" style="display: none;"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <label class="col-xs-4 control-label text-muted text-right">
                                                                        Prioridad:
                                                                    </label>
                                                                    <div class="col-xs-8 selectContainer">
                                                                        <input type="hidden" id="hdnIdPrioridadTramite" value="@(Model.IdPrioridad == 0 ? "" : Model.IdPrioridad.ToString())" />
                                                                        @Html.DropDownListFor(model => model.IdPrioridad, new SelectListItem[0], new { @id = "cboPrioridad", @name = "cboPrioridad", @class = "form-control input-sm" })
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <label class="col-xs-4 control-label text-muted text-right">
                                                                        Iniciador:
                                                                    </label>
                                                                    <div class="col-xs-8">
                                                                        <div class="input-group">
                                                                            @Html.TextBox("txtIniciador", (string)ViewBag.iniciador, new { @class = "form-control", @readonly = "true" })
                                                                            @Html.Hidden("hdnIdPersona", (string)ViewBag.idPersona)
                                                                            <div class="input-group-addon cursor-pointer @(ViewBag.operacion == "Consulta" ? "boton-deshabilitado" : "")" id="persona-search">
                                                                                <span data-placement="bottom" title="Buscar Persona" class="fa-lg fa fa-search black cursor-pointer" aria-hidden="true"></span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    @if (!(bool)ViewBag.esProfesional)
                                                                    {
                                                                        <label class="col-xs-4 control-label text-muted text-right">
                                                                            Fecha Libro Diario:
                                                                        </label>
                                                                        <div class="col-xs-8 textBoxContainer">
                                                                            @if (Model.FechaLibro.GetValueOrDefault().Year < 1900)
                                                                            {
                                                                                ViewBag.FechaLibro = null;
                                                                            }
                                                                            else
                                                                            {
                                                                                ViewBag.FechaLibro = Model.FechaLibro.GetValueOrDefault().ToShortDateString();
                                                                            }
                                                                            @Html.TextBoxFor(model => model.FechaLibro, new { @class = "form-control", @maxlength = "10", Value = ViewBag.FechaLibro, @readonly = "readonly" })
                                                                        </div>
                                                                    }
                                                                    else
                                                                    {
                                                                        <label class="col-xs-4 control-label text-muted text-right">
                                                                            Vigencia Reingreso:
                                                                        </label>
                                                                        <div class="col-xs-8 textBoxContainer">
                                                                            @Html.TextBox("txtVigenciaReingreso", (string)@ViewBag.VigenciaReingreso, new { @class = "form-control", @readonly = "readonly" })
                                                                        </div>
                                                                    }
                                                                </div>
                                                            </div>
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <label class="col-xs-4 control-label text-muted text-right">
                                                                        Fecha Vto:
                                                                    </label>
                                                                    <div class="col-xs-8 textBoxContainer">
                                                                        @if (Model.FechaVenc.GetValueOrDefault().Year < 1900)
                                                                        {
                                                                            ViewBag.FechaVenc = null;
                                                                        }
                                                                        else
                                                                        {
                                                                            ViewBag.FechaVenc = Model.FechaVenc.GetValueOrDefault().ToShortDateString();
                                                                        }
                                                                        @Html.TextBoxFor(model => model.FechaVenc, new { @class = "form-control", @maxlength = "10", Value = ViewBag.FechaVenc, @readonly = "readonly" })
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <label class="col-xs-4 control-label text-muted text-right">
                                                                        Jurisdicci&oacute;n:
                                                                    </label>
                                                                    <div class="col-xs-8 selectContainer">
                                                                        @Html.DropDownListFor(model => model.IdJurisdiccion, (IEnumerable<SelectListItem>)ViewData["jurisdicciones"], new { @id = "cboJurisdiccion", @name = "cboJurisdiccion", @class = "form-control input-sm", onchange = "jurisdiccionChange(this.value)", onselectedindexchanged = "jurisdiccionChange(this.value)" })
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <label class="col-xs-4 control-label text-muted text-right">
                                                                        Localidad:
                                                                    </label>
                                                                    <div class="col-xs-8 selectContainer">
                                                                        <input type="hidden" id="hdnIdLocalidad" value="@(Model.IdLocalidad == 0 ? "" : Model.IdLocalidad.ToString())" />
                                                                        @Html.DropDownListFor(model => model.IdLocalidad, new SelectListItem[0], new { @id = "cboLocalidad", @name = "cboLocalidad", @class = "form-control input-sm" })
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <label class="col-xs-4 control-label text-muted text-right">
                                                                        Partida:
                                                                    </label>
                                                                    <div class="col-xs-8">
                                                                        <div class="input-group">
                                                                            @Html.TextBoxFor(model => model.UnidadTributaria.CodigoProvincial, new { @class = "form-control", @readonly = "true", @id = "partida" })
                                                                            @Html.HiddenFor(model => model.IdUnidadTributaria, new { @class = "form-control", @readonly = "true", @id = "idUnidadTributaria" })
                                                                            <div class="input-group-addon cursor-pointer @(ViewBag.operacion == "Consulta" ? "boton-deshabilitado" : "")" id="partida-search">
                                                                                <span data-placement="bottom" title="Buscar Partida" class="fa-lg fa fa-search black cursor-pointer" aria-hidden="true"></span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-xs-6">
                                                                <div class="form-group">
                                                                    <label class="col-xs-4 control-label text-muted text-right">
                                                                        Propietario/Poseedor:
                                                                    </label>
                                                                    <div class="col-xs-8 textBoxContainer">
                                                                        @Html.TextBox("txtTitular", (string)ViewBag.titular, new { @class = "form-control", @readonly = "true" })
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-xs-12">
                                                                <div class="form-group">
                                                                    <label class="col-xs-2 control-label text-muted text-right">
                                                                        Motivo:
                                                                    </label>
                                                                    <div class="col-xs-10 selectContainer">
                                                                        @Html.TextAreaFor(model => model.Motivo, new { @style = "margin-left: 0px; margin-top: 5px; height: 80px;", @maxlength = "4000", @class = "form-control" })
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <div id="tabDatosEspecificos" class="tab-pane">
                                            <div class="datosEspecificos-body tab-body">
                                                <div id="datosEspecificos-content" style="padding: 0 15px;">
                                                    <div id="divDatosEspecificos" class="form-horizontal">
                                                        <div id="divTramiteEsp" class="form-group tabDatos">
                                                            <div class="row vertical-align">
                                                                <div class="col-xs-5" style="display: inline;">
                                                                    <div class="form-group">
                                                                        <label class="control-label text-muted">
                                                                            Arbol de Entradas
                                                                        </label>
                                                                        <div id="divjsObjetos" class="form-control jstree-border" style="border: 1px solid rgb(53, 149, 180);min-height: 60vh;">
                                                                            <div id="js_objetos"></div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-xs-1" id="datosEspecificos-controls">
                                                                    <dl>
                                                                        <dt><span class="fa fa-2x fa-question-circle blue-tooltip" data-toggle="tooltip" data-placement="right" id="plantillaArbol"></span></dt>
                                                                        <dt><span class="fa fa-2x fa-plus-circle cursor-pointer black" aria-hidden="false" id="btn_AgregarObjeto"></span></dt>
                                                                        <dt><span class="fa fa-2x fa-pencil cursor-pointer black boton-deshabilitado" aria-hidden="true" id="btn_ModificarObjeto"></span></dt>
                                                                        <dt><span class="fa fa-2x fa-minus-circle cursor-pointer black boton-deshabilitado" aria-hidden="true" id="btn_EliminarObjeto"></span></dt>
                                                                    </dl>
                                                                </div>
                                                                <div class="col-xs-6" style="display: inline;">
                                                                    <div id="divEdicionObjetos" class="form-group" style="display: none;">
                                                                        <label class="control-label text-muted">
                                                                            Edici&oacute;n de Entradas
                                                                        </label>

                                                                        <div style="border: 1px solid rgb(53, 149, 180); height: 60vh; overflow-y: auto">

                                                                            <div style="display: flex; margin: 10px;">
                                                                                <label id="lblObjeto" class="col control-label text-muted" style="padding-right: 10px;">
                                                                                    Entrada:
                                                                                </label>
                                                                                <div class="col">
                                                                                    @Html.DropDownList("cboObjetoEspecificoTramite", new SelectListItem[0], new
                                                                                    {
                                                                                        id = "cboObjetoEspecificoTramite",
                                                                                        @class = "form-control input-sm",
                                                                                        onchange = "cboObjetoEspecificoTramiteChange(this.value, '" + GeoSit.Client.Web.Models.Operacion.Alta + "')"
                                                                                    })
                                                                                </div>
                                                                                <span id="btn_Guardar" data-placement="right" title="Guardar" data-original-title="Guardar" id="save" class="fa fa-save fa-2x pull-right cursor-pointer" style="color: green;"></span>
                                                                                <span id="btn_Cerrar" aria-hidden="true" class="fa fa-close fa-2x black cursor-pointer pull-right" aria-label="Cerrar" title="Cerrar"></span>
                                                                            </div>

                                                                            <div id="divAtributosDeObjeto" style="display: none;">
                                                                                <label id="lblAtributosObjeto" class="control-label text-muted" style="margin-left: 10px">
                                                                                    Atributos de la Entrada:
                                                                                </label>
                                                                                <form id="divEdicionObjetoContainer" style="margin: 10px; background-color: #ebf2e0; border-color: #47627d; border-width: 1px; border-style: solid;"></form>
                                                                            </div>
                                                                            <div id="grillaPadresContainer" style="display:none;">
                                                                                <div>
                                                                                    <label id="lblObjetosRelacionados" class="control-label text-muted col-xs-12">
                                                                                        Entradas relacionadas:
                                                                                    </label>
                                                                                    <div class="col-xs-12">
                                                                                        <div class="col-xs-11 remove-padding">
                                                                                            <table id="Grilla_ObjetosRelacionados" class="table table-striped table-bordered table-responsive col-xs-11">
                                                                                                <thead><tr><th>Entrada</th></tr></thead>
                                                                                                <tbody></tbody>
                                                                                            </table>
                                                                                        </div>
                                                                                        <div class="col-xs-1">
                                                                                            <dl>
                                                                                                <dt>
                                                                                                    <input type="hidden" id="TipoOperacion" value="">
                                                                                                    <span id="addFatherBtn" style="margin-top: 1.2em" class="fa fa-2x fa-plus-circle cursor-pointer black add_relation" aria-hidden="false"></span>
                                                                                                </dt>
                                                                                            </dl>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="tabNotasAdjuntos" class="tab-pane">
                                            <div class="tab-body" style="padding:0">
                                                <div class="tabla-con-botones">
                                                    <table id="Grilla_documentos" class="table table-striped table-bordered table-responsive">
                                                        <thead>
                                                            <tr>
                                                                <th> Id</th>
                                                                <th width="105px"> Fecha</th>
                                                                <th width="90px"> Tipo Documento</th>
                                                                <th> Nombre y Apellido</th>
                                                                <th> Descripci&oacute;n</th>
                                                                <th width="90px"> Adjunto</th>
                                                                <th> IdTipoDoc</th>
                                                                <th> Fecha de Aprobación</th>
                                                                <th width="10px"> Obs</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @if (Model.TramiteDocumentos != null)
                                                            {
                                                                foreach (var doc in Model.TramiteDocumentos)
                                                                {
                                                                    <tr>
                                                                        <td>@doc.id_documento</td>
                                                                        <td>@doc.FechaAlta.ToShortDateString()</td>
                                                                        <td>@doc.Documento.Tipo.Descripcion</td>
                                                                        <td>@doc.Usuario_Alta.Nombre, @doc.Usuario_Alta.Apellido</td>
                                                                        <td>@doc.Documento.descripcion</td>
                                                                        <td>@doc.Documento.nombre_archivo@doc.Documento.extension_archivo</td>
                                                                        <td>@doc.Documento.id_tipo_documento</td>
                                                                        <td>@doc.FechaAprobacion</td>
                                                                        <td>@doc.Documento.observaciones</td>
                                                                    </tr>
                                                                }
                                                            }
                                                        </tbody>
                                                    </table>
                                                    <dl style="right: 15px;">
                                                        @if (PuedeGrabar)
                                                        {
                                                            <dt><span id="btnAgregarNota" class="fa fa-plus-circle fa-2x black cursor-pointer btn-habilitado" aria-hidden="true" title="Agregar Nota"></span></dt>
                                                            <dt><span id="btnEliminarNota" class="fa fa-2x fa-minus-circle cursor-pointer black boton-deshabilitado" aria-hidden="true" title="Eliminar Nota"></span></dt>
                                                            <dt><span id="btnEditarNota" class="fa fa-2x fa-pencil cursor-pointer black boton-deshabilitado" aria-hidden="true" title="Editar Nota"></span></dt>
                                                        }
                                                        <dt><span id="btnInformeObservaciones" class="fa fa-print fa-2x black cursor-pointer btn-habilitado" aria-hidden="true" title="Generar Informe Observaciones"></span></dt>
                                                    </dl>
                                                </div>
                                            </div>
                                        </div>

                                        <div id="tabDesgloses" class="tab-pane">
                                            <div class="tab-body" style="padding:0">
                                                <div class="tabla-con-botones">
                                                    <table id="Grilla_desgloses" class="table table-striped table-bordered table-responsive">
                                                        <thead>
                                                            <tr>
                                                                <th> Id</th>
                                                                <th width="105px"> Fecha</th>
                                                                <th width="100px"> Folio Desde</th>
                                                                <th width="100px"> Folio Hasta</th>
                                                                <th width="100px"> Cantidad Folios</th>
                                                                <th> Destinatario</th>
                                                                <th width="10px"> Obs</th>
                                                                <th> IdDesgloseDestino</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @if (Model.Desgloses != null)
                                                            {
                                                                foreach (var desglose in Model.Desgloses)
                                                                {
                                                                    <tr>
                                                                        <td>@desglose.IdDesglose</td>
                                                                        <td>@desglose.FechaAlta</td>
                                                                        <td>@desglose.FolioDesde</td>
                                                                        <td>@desglose.FolioHasta</td>
                                                                        <td>@desglose.FolioCant</td>
                                                                        <td>@desglose.DesgloseDestino.Descripcion</td>
                                                                        <td>@desglose.Observaciones</td>
                                                                        <td>@desglose.IdDesgloseDestino</td>
                                                                    </tr>
                                                                }
                                                            }
                                                        </tbody>
                                                    </table>
                                                    <dl style="right: 15px;">
                                                        <dt><span id="btnDesgloseAgregar" class="fa fa-plus-circle fa-2x black cursor-pointer btn-habilitado" aria-hidden="true" title="Agregar Desglose"></span></dt>
                                                        <dt><span id="btnDesgloseEliminar" class="fa fa-minus-circle fa-2x black cursor-pointer boton-deshabilitado" aria-hidden="true" title="Eliminar Desglose"></span></dt>
                                                    </dl>
                                                </div>
                                            </div>
                                        </div>

                                        <div id="tabMovimientos" class="tab-pane">
                                            <div class="tab-body">
                                                <div class="tabla-sin-botones">
                                                    <table id="Grilla_movimientos" class="table table-striped table-bordered table-responsive">
                                                        <thead>
                                                            <tr>
                                                                <th> Id</th>
                                                                <th> Fecha</th>
                                                                <th> Tipo Mov.</th>
                                                                <th> Usuario</th>
                                                                <th> Destinatario</th>
                                                                <th> Estado</th>
                                                                <th> Remito</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            @if (Model.Movimientos != null)
                                                            {
                                                                foreach (var mov in Model.Movimientos)
                                                                {
                                                                    <tr>
                                                                        <td>@mov.IdMovimiento</td>
                                                                        <td>@mov.FechaAlta</td>
                                                                        <td>@mov.TipoMovimiento.Descripcion</td>
                                                                        <td>@mov.Usuario_Alta.NombreApellidoCompleto</td>
                                                                        <td>@mov.SectorDestino.Nombre</td>
                                                                        <td>@mov.Estado.Descripcion</td>
                                                                        <td>@(mov.Remito != null ? mov.Remito.IdRemito.ToString() : string.Empty)</td>
                                                                    </tr>
                                                                }
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>

                                        <div id="tabRequisitos" class="tab-pane">
                                            <div class="tab-body">
                                                <div class="form-check divChkRequisitos" style="padding:0;">

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="col-xs-2 text-left">
                        <div class="btn-group dropup">
                            <button id="btnAcciones" type="button" class="btn btn-accion" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Acciones <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                @if (ViewBag.operacion == "Consulta")
                                {
                                    if (PuedeGrabar)
                                    {

                                        <li><a href="javascript:void(0)" onclick="javascript:grabar();">Grabar</a></li>
                                        <li><div class="dropdown-divider"></div></li>
                                    }

                                    if ((ViewData["accionesGenerales"] as List<METipoMovimiento>).Any())
                                    {

                                        foreach (var item in (ViewData["accionesGenerales"] as List<METipoMovimiento>))
                                        {
                                            <li><a href="javascript:void(0)" onclick="javascript:edicionEjecutar(@item.IdTipoMovimiento);">@item.Descripcion</a></li>
                                        }
                                    }
                                }
                                else
                                {
                                    <li><a href="javascript:void(0)" onclick="javascript:grabar();">Grabar</a></li>
                                    if (ViewBag.confirmarHabilitado)
                                    {
                                        <li><div class="dropdown-divider"></div></li>
                                        <li><a href="javascript:void(0)" onclick="javascript:confirmar();">Confirmar</a></li>
                                    }
                                    if ((bool)ViewBag.esProfesional && (Model.IdEstado == (int)Enumerators.EnumEstadoTramite.None || Model.IdEstado == (int)Enumerators.EnumEstadoTramite.Provisorio))
                                    {
                                        <li><div class="dropdown-divider"></div></li>
                                        <li><a href="javascript:void(0)" onclick="javascript:presentar();">Presentar</a></li>
                                    }
                                    if ((bool)ViewBag.esProfesional && (Model.IdEstado == (int)Enumerators.EnumEstadoTramite.Despachado) && ViewBag.puedeReingresar == 1)
                                    {
                                        <li><div class="dropdown-divider"></div></li>
                                        <li><a href="javascript:void(0)" onclick="javascript:reingresar();">Reingresar</a></li>
                                    }
                                    if ((ViewData["accionesGenerales"] as List<METipoMovimiento>).Any())
                                    {
                                        <li><div class="dropdown-divider"></div></li>
                                        foreach (var item in (ViewData["accionesGenerales"] as List<METipoMovimiento>))
                                        {
                                            <li><a href="javascript:void(0)" onclick="javascript:edicionEjecutar(@item.IdTipoMovimiento);">@item.Descripcion</a></li>
                                        }
                                    }
                                }
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal theme_new fade mensaje" id="mensajeModalEdicionTramite" tabindex="-2" role="dialog" aria-labelledby="TituloAdvertencia" aria-hidden="true" style="z-index:99999999;" data-backdrop="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <input type="hidden" id="TipoAdvertencia" value="">
                <h3 class="modal-title col-xs-10" id="TituloAdvertencia">Titulo</h3>
                <span aria-hidden="true" class="fa fa-close fa-2x white cursor-pointer pull-right" data-dismiss="modal" aria-label="Cerrar" title="Cerrar"></span>
            </div>
            <div class="modal-body">
                <div id="MensajeAlerta" class="alert alert-warning alert-dismissible" role="alert">
                    <p id="DescripcionAdvertencia">Está a punto de DESACTIVAR al usuario Perez, Juan <br>Está seguro de continuar?</p>
                </div>
            </div>
            <div class="modal-footer">
                <div class="col-xs-4 pull-right">
                    <span id="btnAceptarAdvertencia" aria-hidden="true" data-dismiss="modal" data-placement="right" title="Aceptar" data-original-title="Aceptar" class="fa fa-check-circle light-blue fa-2x cursor-pointer"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal theme_new fade mensaje" id="modalAgregarPadre" tabindex="-2" role="dialog" aria-labelledby="TituloAdvertencia" aria-hidden="true" style="z-index:99999999;" data-backdrop="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <input type="hidden" id="objetoPadre" value="">
                <h3 class="modal-title col-xs-10" id="TituloAdvertencia">Agregar Padre</h3>
                <span aria-hidden="true" class="fa fa-close fa-2x white cursor-pointer pull-right" data-dismiss="modal" aria-label="Cerrar" title="Cerrar"></span>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="form-group">
                        <div class="col-xs-12">

                            <label class="col-xs-12 control-label text-muted">
                                <b>
                                    Objeto a relacionar:
                                </b>
                            </label>
                            <div class="col-xs-12">
                                <select style="height: 3em" id="selectAddFather"></select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="col-xs-4 pull-right">
                    <span id="cancelFatherBtn" aria-hidden="true" data-dismiss="modal" data-placement="right" title="Cancelar" data-original-title="Aceptar" class="fa fa-times-circle fa-2x cursor-pointer" onclick="$('#modalAgregarPadre').modal('hide')"></span>
                    <span id="confirmFatherBtn" aria-hidden="true" data-dismiss="modal" data-placement="right" title="Aceptar" data-original-title="Aceptar" class="fa fa-check-circle light-blue fa-2x cursor-pointer"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal theme_new fade mensaje" id="mensajeModalEliminarTramite" tabindex="-2" role="dialog" aria-labelledby="TituloAdvertencia" aria-hidden="true" style="z-index:99999999;" data-backdrop="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <input type="hidden" id="TipoAdvertencia" value="">
                <h3 class="modal-title col-xs-10" id="TituloAdvertencia">Eliminar</h3>
                <span id="btnCancelarAdvertenciaEliminar" aria-hidden="true" class="fa fa-close fa-2x white cursor-pointer pull-right" data-dismiss="modal" aria-label="Cerrar" title="Cerrar"></span>
            </div>
            <div class="modal-body">
                <div id="MensajeAlerta" class="alert alert-warning alert-dismissible" role="alert">
                    <p id="DescripcionAdvertencia">¿Está seguro de eliminar la entrada seleccionada?</p>
                </div>
            </div>
            <div class="modal-footer">
                <div class="col-xs-4 pull-right">
                    <span id="btnAceptarAdvertenciaEliminar" aria-hidden="true" data-dismiss="modal" data-placement="right" title="Aceptar" data-original-title="Aceptar" class="fa fa-check-circle light-blue fa-2x cursor-pointer"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal theme_new fade mensaje" id="mensajeModalCancelarTramite" tabindex="-2" role="dialog" aria-labelledby="TituloAdvertencia" aria-hidden="true" style="z-index:99999999;" data-backdrop="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <input type="hidden" id="TipoAdvertencia" value="">
                <h3 class="modal-title col-xs-10" id="TituloAdvertencia">Cancelar</h3>
                <span aria-hidden="true" class="fa fa-close fa-2x white cursor-pointer pull-right" data-dismiss="modal" aria-label="Cerrar" title="Cerrar"></span>
            </div>
            <div class="modal-body">
                <div id="MensajeAlerta" class="alert alert-warning alert-dismissible" role="alert">
                    <p id="DescripcionAdvertencia">¿Está seguro de cancelar la operación?</p>
                </div>
            </div>
            <div class="modal-footer">
                <div class="col-xs-4 pull-right">
                    <span id="btnAceptarAdvertenciaCancelar" aria-hidden="true" data-dismiss="modal" data-placement="right" title="Aceptar" data-original-title="Aceptar" class="fa fa-check-circle light-blue fa-2x cursor-pointer"></span>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade theme_new" id="ModalDesgloses" tabindex="-3" role="dialog" aria-labelledby="TituloInfoDesgloses" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="TituloInfoDesgloses">@ViewBag.Title</h3>
                <span aria-hidden="true" class="fa fa-close fa-2x white cursor-pointer pull-right" data-dismiss="modal" aria-label="Cerrar" title="Cerrar"></span>
            </div>
            <div class="modal-body">
                <div class="body-content">
                    <div class="form-horizontal">
                        <div class="form-group">
                            <label id="lblDesgloseFolioDesde" class="col-xs-3 control-label text-muted">
                                Folio desde:
                            </label>
                            <div class="col-xs-9">
                                @Html.TextBox("txtDesgloseFolioDesde", null, new { @class = "form-control", @placeholder = "Ingrese Folio desde" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label id="lblDesgloseFolioHasta" class="col-xs-3 control-label text-muted">
                                Folio hasta:
                            </label>
                            <div class="col-xs-9">
                                @Html.TextBox("txtDesgloseFolioHasta", null, new { @class = "form-control", @placeholder = "Ingrese Folio hasta" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label id="lblDesgloseCantFolios" class="col-xs-3 control-label text-muted">
                                Cantidad de folios:
                            </label>
                            <div class="col-xs-9">
                                @Html.TextBox("txtDesgloseFolioCant", null, new { @class = "form-control", @placeholder = "Ingrese Cantidad de folios" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label id="lblDesgloseDestino" class="col-xs-3 control-label text-muted">
                                Destino:
                            </label>
                            <div class="col-xs-9">
                                @Html.DropDownList("cboDesgloseDestino", (IEnumerable<SelectListItem>)ViewData["desglosesDestinos"], new { @class = "form-control input-sm" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label id="lblDesgloseObservacion" class="col-xs-3 control-label text-muted">
                                Observaci&oacute;n:
                            </label>
                            <div class="col-xs-9">
                                @Html.TextArea("txtDesgloseObservacion", null, new { @style = "margin-left: 0px; margin-top: 5px; height: 80px;", @maxlength = "4000", @class = "form-control", @placeholder = "Ingrese una observación" })
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="col-xs-4 pull-right">
                    <span id="btnAceptarInfoDesgloses" aria-hidden="true" data-dismiss="modal" data-placement="right" title="Aceptar" data-original-title="Aceptar" class="fa fa-check-circle light-blue fa-2x cursor-pointer"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade theme_new" id="ModalDocumentos" tabindex="-3" role="dialog" aria-labelledby="TituloInfoDocumentos" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="TituloInfoDocumentos">@ViewBag.Title</h3>
                <span aria-hidden="true" class="fa fa-close fa-2x white cursor-pointer pull-right" data-dismiss="modal" aria-label="Cerrar" title="Cerrar"></span>
            </div>
            <div class="modal-body">
                <div class="body-content">
                    <div class="form-horizontal">
                        @Html.Hidden("hdnUsuarioNombre", (string)ViewBag.usuarioNombre)
                        @Html.Hidden("hdnUsuarioLogin", (string)ViewBag.usuarioLogin)
                        <div class="form-group">
                            <label id="lblDocumentoTipoDocumento" class="col-xs-3 control-label text-muted">
                                Tipo Documento:
                            </label>
                            <div class="col-xs-9">
                                @Html.DropDownList("cboTipoDocumento", (IEnumerable<SelectListItem>)ViewData["tiposDocumentos"], new { @class = "form-control input-sm" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label id="lblDocumentoDescripcion" class="col-xs-3 control-label text-muted">
                                Descripci&oacute;n:
                            </label>
                            <div class="col-xs-9">
                                @Html.TextArea("txtDocumentoDescripcion", null, new { @style = "margin-left: 0px; margin-top: 5px; height: 80px;", @maxlength = "100", @class = "form-control", @placeholder = "Ingrese una descripción" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label id="lblDocumentoArchivo" class="col-xs-3 control-label text-muted">
                                Archivo:
                            </label>
                            <div class="col-xs-9">
                                <div class="input-group">
                                    @Html.TextBox("txtDocumentoArchivo", null, new { @class = "form-control", @readonly = "readonly", @placeholder = "Ingrese el nombre del archivo" })
                                    <span class="input-group-addon cursor-pointer">
                                        <span id="btnDocumentoExplorar" class="fa fa-file black" aria-hidden="true" title="Explorar"></span>
                                    </span>
                                </div>
                                @Html.Hidden("hdnExtensionArchivo", "")
                                @Html.TextBox("txtDocumentoArchivoFile", null, new { type = "file", @class = "hidden", onchange = "changeFile(this)" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label id="lblFechaAprobacion" class="col-xs-3 control-label text-muted hidden">
                                Fecha de Aprobación:
                            </label>
                            <div class="col-xs-9">
                                @Html.TextBox("fecha-Aprobacion", "dd/mm/yyyy", new { @class = "form-control hidden", @id = "fecha-aprobacion", @placeholder = "XX/XX/XXXX" })
                            </div>
                        </div>
                        <div class="form-group">
                            <label id="lblDocumentoObservacion" class="col-xs-3 control-label text-muted">
                                Observaci&oacute;n:
                            </label>
                            <div class="col-xs-9">
                                @Html.TextArea("txtDocumentoObservacion", null, new { @style = "margin-left: 0px; margin-top: 5px; height: 80px;", @maxlength = "4000", @class = "form-control", @placeholder = "Ingrese una observación" })
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="col-xs-4 pull-right">
                    <span id="btnAceptarInfoDocumentos" aria-hidden="true" data-placement="right" title="Aceptar" data-original-title="Aceptar" class="fa fa-check-circle light-blue fa-2x cursor-pointer"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="buscador-container"></div>
<div id="container-externo"></div>
<div id="contenido-formulario"></div>

<div class="modal fade theme_new mensaje" id="ModalInfoDeclaracionesJuradas" tabindex="666" role="dialog" aria-labelledby="TituloInfoDeclaracionesJuradas" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="TituloInfoDeclaracionesJuradas">Titulo</h3>
                <span id="btnInfoDeclaracionesJuradasCancel" aria-hidden="true" class="fa fa-close fa-2x white cursor-pointer pull-right" data-dismiss="modal" aria-label="Cerrar" title="Cerrar"></span>
            </div>
            <div class="modal-body">
                <div class="alert alert-success alert-dismissible" role="alert">
                    <p id="DescripcionInfoDeclaracionesJuradas">Descripcion de la informacion</p>
                </div>
            </div>
            <div class="modal-footer" style="display:none;">
                <div class="col-lg-4 pull-right">
                    <span id="btnInfoDeclaracionesJuradasOK" aria-hidden="true" data-dismiss="modal" title="Seleccionar" class="fa fa-check-circle fa-3x light-blue cursor-pointer"></span>
                </div>
            </div>
        </div>
    </div>
</div>



<script src="~/Scripts/jquery.dataTables.min.js"></script>
<script src="~/Scripts/dataTables.bootstrap.js"></script>
<script src="~/Scripts/fileinput.min.js"></script>
<script src="~/Scripts/formValidation.min.js"></script>
<script src="~/Scripts/bootstrapValidation.min.js"></script>
<script src="~/Scripts/jstree/dist/jstree.min.js"></script>
<script src="~/Scripts/select2.min.js"></script>

<script>
    function loadDatosEspecificos() {
            @if (Model.IdTramite > 0 && (bool)ViewBag.habilitaDatosEspecificos)
            {
                <text>
                    objetoTramiteChange(document.getElementById('cboObjetoTramite').value, false);
                    createTree("js_objetos", []);
                    const showErrorDatosEspecificos = () => {
                        mostrarMensaje(3, "Carga de Datos Específicos", "No se pudieron cargar los datos específicos. Por favor, vuelva a abrir el trámite");
                        $("#btnAcciones", "#modal-EdicionTramite").attr("disabled", "disabled");
                    }
                    return new Promise(function (resolve, reject) {
                        $.ajax({
                            type: "GET",
                            cache: true,
                            crossDomain: true,
                            url: BASE_URL + "mesaentradas/GetDatosEspecificos",
                            success: function (datosEspecificos) {
                                setDatosEspecificos(datosEspecificos);
                                resetAndReloadTree();
                                resolve(datosEspecificos);
                            },
                            error: function (err) {
                                console.log(err);
                                showErrorDatosEspecificos()
                                reject();
                            },
                            complete: function () {
                                $('a[href="#tabDatosEspecificos"]').prop("disabled", false);
                                $('a[href="#tabDatosEspecificos"]').removeClass("disabled");
                            }
                        });
                    });
                </text>
            }
            else
            {
                <text>
                    $("#datosEspecificos-content").niceScroll(getNiceScrollConfig());
                    createTree("js_objetos", []);
                </text>
            }
        }

        function disableTree() {
            $('#js_objetos li').each(function () {
                $("#js_objetos").jstree().disable_node(this.id);
            });
        }

        function enableTree() {
            $('#js_objetos li').each(function () {
                $("#js_objetos").jstree().enable_node(this.id);
            });
        }

        $('#js_objetos').on("deselect_all.jstree", function () {
            $('#btn_ModificarObjeto').addClass('boton-deshabilitado');
            $('#btn_EliminarObjeto').addClass('boton-deshabilitado');
            $("#divEdicionObjetoContainer").html("");
            $("#divEdicionObjetos").hide();
            $("#divAtributosDeObjeto").hide();

            setModoLectura();
        });

        $('#js_objetos').on("select_node.jstree", function (e, data) {
            var selected = getTreeSelectedElements();
            if (selected.length === 1) {
                $('#btn_ModificarObjeto').removeClass('boton-deshabilitado');
                $('#btn_EliminarObjeto').removeClass('boton-deshabilitado');
                if ($("#hdnOperacion").val() === "Consulta") {
                    $('#btn_ModificarObjeto').addClass('boton-deshabilitado');
                    $('#btn_EliminarObjeto').addClass('boton-deshabilitado');
                }
            } else {
                $('#btn_ModificarObjeto').addClass('boton-deshabilitado');
                $('#btn_EliminarObjeto').addClass('boton-deshabilitado');

                setModoLectura();
            }

            var selected = selected[0];
            var arbolObjetoSeleccionado = getDatosEspecificos().find(x => x.Guid === selected?.data.Guid && x.IdTramiteEntrada == selected?.data.IdTramiteEntrada);

            document.getElementById("divEdicionObjetos").style.display = "block";

            var selectedElements = {
                selectedGuids: arbolObjetoSeleccionado.ParentGuids,
                selectedIds: arbolObjetoSeleccionado.ParentIdTramiteEntradas
            };
            initGrillaPadres(selectedElements);

            $("#cboObjetoEspecificoTramite").val(arbolObjetoSeleccionado.TipoObjeto.Id);
            cboObjetoEspecificoTramiteChange(arbolObjetoSeleccionado.TipoObjeto.Id,
                '@GeoSit.Client.Web.Models.Operacion.Modificacion',
                    function () {
                        $("#divEdicionObjetoContainer :input").prop("disabled", true);
                        $("#cboObjetoEspecificoTramite").val(arbolObjetoSeleccionado.TipoObjeto.Id);
                        $('#btn_Guardar').addClass('disabled');
                        $('#btn_Cerrar').addClass('disabled');
                    }
            );
            cboObjetoEspecificoTramite.disabled = true;

        });

    $('#divjsObjetos').css({cursor:"pointer"});
    $('#divjsObjetos').off("click").on("click", function (e) {
        if ($(e.target).prop('tagName') !== "A") {
            $("#js_objetos").jstree().deselect_all(true);
        }
    });

    //# sourceURL=loaddatosespecificos.js
</script>

<script src="~/Scripts/MesaEntradas/ediciontramite.js"></script>

<style>
    /*JQuery Validate*/
    .error {
        color: #a94442;
    }

    .vertical-align {
        display: flex;
        flex-direction: row;
    }

        .vertical-align > [class^="col-"],
        .vertical-align > [class*=" col-"] {
            display: flex;
            align-items: center;
            justify-content: center; /* Optional, to align inner items
                              horizontally inside the column */
        }


    .blue-tooltip.tooltip > .tooltip-inner {
        white-space: pre-wrap;
        min-width: 250px;
        max-width: none;
        text-align: left;
    }

    .blue-tooltip.tooltip > .tooltip-arrow {
        display: none !important;
    }
</style>
